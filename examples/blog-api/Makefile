.PHONY: help run build test test-coverage lint docker-build docker-run clean

help: ## Afficher l'aide
	@grep -E '^[a-zA-Z_-]+:.*?## .*$$' $(MAKEFILE_LIST) | sort | awk 'BEGIN {FS = ":.*?## "}; {printf "\033[36m%-20s\033[0m %s\n", $$1, $$2}'

run: ## Lancer l'application
	@echo "ğŸš€ Starting blog-api..."
	go run ./cmd/main.go

build: ## Build le binaire
	@echo "ğŸ”¨ Building binary..."
	go build -o bin/blog-api ./cmd/main.go
	@echo "âœ… Build complete: bin/blog-api"

test: ## ExÃ©cuter les tests
	@echo "ğŸ§ª Running tests..."
	go test -v ./...

test-coverage: ## Tests avec coverage
	@echo "ğŸ“Š Running tests with coverage..."
	go test -v -coverprofile=coverage.out ./...
	go tool cover -html=coverage.out -o coverage.html
	@echo "âœ… Coverage report: coverage.html"

lint: ## Linter le code
	@echo "ğŸ” Running linter..."
	golangci-lint run ./...

docker-build: ## Build l'image Docker
	@echo "ğŸ³ Building Docker image..."
	docker build -t blog-api:latest .
	@echo "âœ… Docker image built: blog-api:latest"

docker-run: ## Lancer le conteneur Docker
	@echo "ğŸ³ Running Docker container..."
	docker run -d --name blog-api -p 8080:8080 --env-file .env blog-api:latest

docker-compose: ## Lancer avec docker-compose
	@echo "ğŸ³ Starting with docker-compose..."
	docker-compose up -d
	@echo "âœ… Services started. API: http://localhost:8080"

docker-compose-down: ## ArrÃªter docker-compose
	@echo "ğŸ›‘ Stopping docker-compose..."
	docker-compose down

clean: ## Nettoyer les artifacts
	@echo "ğŸ§¹ Cleaning..."
	rm -rf bin/
	rm -f coverage.out coverage.html
	@echo "âœ… Cleaned"

.DEFAULT_GOAL := help
